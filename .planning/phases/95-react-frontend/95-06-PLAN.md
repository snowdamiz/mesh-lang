---
phase: 95-react-frontend
plan: 06
type: execute
wave: 2
depends_on: ["95-01"]
files_modified:
  - frontend/src/pages/alerts.tsx
  - frontend/src/pages/settings.tsx
  - frontend/src/components/alerts/alert-rule-form.tsx
  - frontend/src/components/alerts/alert-list.tsx
  - frontend/src/components/settings/project-settings.tsx
  - frontend/src/components/settings/team-management.tsx
  - frontend/src/components/settings/api-keys.tsx
  - frontend/src/components/settings/storage-info.tsx
autonomous: true

must_haves:
  truths:
    - "User can view a list of alert rules and create new ones with condition configuration"
    - "User can toggle alert rules on/off and delete them"
    - "User can view fired alerts and acknowledge/resolve them"
    - "User can view and update project settings (retention days, sample rate)"
    - "User can manage team members (add, change role, remove)"
    - "User can manage API keys (create, revoke)"
    - "User can view storage usage"
  artifacts:
    - path: "frontend/src/pages/alerts.tsx"
      provides: "Alert rules and fired alerts page with CRUD"
    - path: "frontend/src/pages/settings.tsx"
      provides: "Settings page with tabs for project, team, API keys, storage"
    - path: "frontend/src/components/alerts/alert-rule-form.tsx"
      provides: "Alert rule creation/editing form"
    - path: "frontend/src/components/settings/team-management.tsx"
      provides: "Team member management UI"
    - path: "frontend/src/components/settings/api-keys.tsx"
      provides: "API key management UI"
  key_links:
    - from: "frontend/src/pages/alerts.tsx"
      to: "frontend/src/lib/api.ts"
      via: "api.alerts.* calls"
      pattern: "api\\.alerts"
    - from: "frontend/src/pages/settings.tsx"
      to: "frontend/src/lib/api.ts"
      via: "api.settings.* and api.team.* calls"
      pattern: "api\\.(settings|team)"
---

<objective>
Build the Alerts page (UI-06) and Settings page (UI-07) with full CRUD functionality. The Alerts page has two tabs: Alert Rules (create, toggle, delete) and Fired Alerts (list, acknowledge, resolve). The Settings page has four tabs: Project Settings (retention, sampling), Team Management (members, roles), API Keys (create, revoke), and Storage (usage info).

Purpose: These are the management pages that complete the platform's feature set. Users need to configure alerting rules, manage team access, and tune project settings.
Output: Two fully functional management pages with forms, tables, and action buttons.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/95-react-frontend/95-RESEARCH.md
@.planning/phases/95-react-frontend/95-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build Alerts page with rule management and fired alerts</name>
  <files>
    frontend/src/pages/alerts.tsx
    frontend/src/components/alerts/alert-rule-form.tsx
    frontend/src/components/alerts/alert-list.tsx
  </files>
  <action>
    **Alert Rule Form (`alert-rule-form.tsx`):**
    Form for creating new alert rules, rendered in a dialog.
    - Props: `{ projectId: string, onSubmit: (rule: CreateRulePayload) => void, onCancel: () => void }`
    - Fields:
      - Name: shadcn Input, required
      - Condition Type: shadcn Select with options: "Event Count Threshold", "New Issue", "Issue Regression"
      - Threshold: shadcn Input (number), shown when condition type is "Event Count Threshold"
      - Window (minutes): shadcn Input (number), shown when condition type is "Event Count Threshold"
      - Cooldown (minutes): shadcn Input (number), default 60
    - Action: no webhook/notification configuration -- the backend sends WebSocket alerts only
    - Submit button: "Create Rule" (disabled while submitting, shows loading state)
    - Form validation: name required, threshold > 0, window > 0, cooldown > 0
    - On submit: build the JSON payload matching backend expectations:
      ```json
      {
        "name": "...",
        "condition": { "condition_type": "threshold|new_issue|regression", "threshold": N, "window_minutes": N },
        "action": { "type": "webhook", "url": "" },
        "cooldown_minutes": N
      }
      ```

    **Alert List (`alert-list.tsx`):**
    Table of fired alerts with status and actions.
    - Props: `{ alerts: Alert[], onAcknowledge: (id: string) => void, onResolve: (id: string) => void }`
    - Columns: Rule Name, Status (badge), Message (truncated), Triggered At (relative time), Actions
    - Status badges: active (red dot), acknowledged (yellow), resolved (green)
    - Action buttons: "Acknowledge" (when active), "Resolve" (when active or acknowledged)
    - Uses DataTable from shared components
    - Empty state: "No alerts fired"

    **Alerts Page (`alerts.tsx`):**
    Two-tab layout using shadcn Tabs: "Rules" and "Fired Alerts".

    **Rules tab:**
    - "Create Rule" button in header opens a shadcn Dialog containing AlertRuleForm
    - List of existing rules as cards or table rows:
      - Name, condition description (human-readable), enabled toggle, last fired timestamp, actions
      - Toggle switch: calls `api.alerts.toggleRule(ruleId, { enabled: !current })` on toggle
      - Delete button: confirmation dialog, then `api.alerts.deleteRule(ruleId)`
    - Fetch rules on mount: `api.alerts.rules(projectId)`
    - After create/toggle/delete: refetch rules list

    **Fired Alerts tab:**
    - AlertList component with data from `api.alerts.list(projectId, { status: statusFilter })`
    - Status filter: "All", "Active", "Acknowledged", "Resolved" as shadcn Select
    - After acknowledge/resolve: refetch alerts list
    - Show total count in tab header badge

    WebSocket integration: subscribe to ws-store for `alert` type messages. When an alert fires, show a toast notification (add shadcn sonner component if not already present -- `npx shadcn@latest add sonner`) and increment the fired alerts count.
  </action>
  <verify>
    Run `cd frontend && npx tsc --noEmit` to verify all alert components compile.
  </verify>
  <done>
    Alerts page shows two tabs: Rules (list with create dialog, toggle, delete) and Fired Alerts (table with acknowledge/resolve actions). Alert rule form validates inputs and creates rules via API. Fired alerts list filters by status. WebSocket alert messages trigger toast notifications.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build Settings page with project, team, API keys, and storage tabs</name>
  <files>
    frontend/src/pages/settings.tsx
    frontend/src/components/settings/project-settings.tsx
    frontend/src/components/settings/team-management.tsx
    frontend/src/components/settings/api-keys.tsx
    frontend/src/components/settings/storage-info.tsx
  </files>
  <action>
    **Project Settings (`project-settings.tsx`):**
    Form for viewing and updating project settings.
    - Fetch on mount: `api.settings.get(projectId)`
    - Fields:
      - Retention Days: shadcn Select with options: 30, 60, 90 days
      - Sample Rate: shadcn Input (number between 0.0 and 1.0), with helper text "1.0 = keep all events, 0.5 = keep 50%"
    - "Save Settings" button: calls `api.settings.update(projectId, { retention_days, sample_rate })`
    - Success: show success toast
    - Clean form styling with labels and descriptions

    **Team Management (`team-management.tsx`):**
    Team member list with add/edit/remove actions.
    - Fetch on mount: `api.team.members(orgId)` -- orgId hardcoded as "default" (per research: no org CRUD endpoints exist)
    - Table columns: Name, Email, Role (badge), Joined At, Actions
    - Role badges: owner (bold), admin (default), member (muted)
    - "Add Member" button opens dialog with user_id input and optional role select
    - Role change: inline shadcn Select on the role cell, triggers `api.team.updateRole(orgId, membershipId, { role })`
    - Remove: button with confirmation, calls `api.team.removeMember(orgId, membershipId)`
    - Note in UI: "Organization and project management will be available in a future update" (since those CRUD endpoints don't exist)

    **API Keys (`api-keys.tsx`):**
    API key management list with create/revoke.
    - Fetch on mount: `api.team.apiKeys(projectId)`
    - Table columns: Label, Key Value (partially masked: show first 8 chars + "..."), Created At, Status, Actions
    - "Create API Key" button opens dialog with label input
    - After creating: show the FULL key value ONCE in a copyable field (it won't be shown again -- but per the API it's always returned, so just mask in the list view)
    - Revoke button (with confirmation): calls `api.team.revokeKey(keyId)`
    - Show revoked keys with strikethrough and "Revoked" badge, revoked_at timestamp
    - Copy button on key value cells (clipboard API)

    **Storage Info (`storage-info.tsx`):**
    Read-only storage usage display.
    - Fetch on mount: `api.settings.storage(projectId)`
    - Display: Event Count (formatted number), Estimated Storage (formatted bytes: KB/MB/GB)
    - Simple card layout with large numbers
    - "Refresh" button to re-fetch
    - Helper function to format bytes: `formatBytes(bytes: number) => "1.23 GB"` etc.

    **Settings Page (`settings.tsx`):**
    Four-tab layout using shadcn Tabs: "Project", "Team", "API Keys", "Storage".
    - Each tab renders its respective component
    - Page header: "Settings" with project name subtitle
    - Tabs are horizontal, full-width tab bar
    - Pass activeProjectId and hardcoded orgId ("default") to child components
  </action>
  <verify>
    Run `cd frontend && npx tsc --noEmit` to verify all settings components compile.
    Run `cd frontend && npm run build` to verify production build succeeds.
  </verify>
  <done>
    Settings page shows 4 tabs: Project (retention/sampling settings form), Team (member list with add/role/remove), API Keys (create/revoke with masked display), Storage (event count and estimated bytes). All forms validate and show success/error toasts. Team management notes that org/project CRUD is not yet available.
  </done>
</task>

</tasks>

<verification>
1. `cd frontend && npx tsc --noEmit` passes
2. `cd frontend && npm run build` succeeds
3. Alerts page at `/alerts` shows Rules and Fired Alerts tabs
4. Create Rule dialog opens and validates form inputs
5. Rules can be toggled on/off and deleted
6. Fired alerts can be acknowledged and resolved
7. Settings page at `/settings` shows 4 tabs
8. Project settings form saves retention and sample rate
9. Team management shows member list with role controls
10. API keys can be created and revoked
11. Storage tab shows event count and estimated size
</verification>

<success_criteria>
- Alerts page with Rules tab (create dialog, toggle, delete) and Fired Alerts tab (table with status filter, acknowledge/resolve)
- Alert rule form with condition type, threshold, window, cooldown inputs
- Settings page with 4 tabs: Project, Team, API Keys, Storage
- Project settings form for retention days and sample rate
- Team member management with add/role change/remove
- API key management with create/revoke and masked display
- Storage info with formatted event count and bytes
- Toast notifications for alert events and action success/failure
</success_criteria>

<output>
After completion, create `.planning/phases/95-react-frontend/95-06-SUMMARY.md`
</output>
