---
phase: 95-react-frontend
plan: 04
type: execute
wave: 3
depends_on: ["95-03"]
files_modified:
  - frontend/src/components/detail/event-detail.tsx
  - frontend/src/components/detail/issue-detail.tsx
  - frontend/src/components/detail/stack-trace.tsx
  - frontend/src/components/detail/breadcrumbs.tsx
  - frontend/src/components/detail/tag-list.tsx
autonomous: true

must_haves:
  truths:
    - "Clicking an event row opens a push panel showing full event detail with stack trace, breadcrumbs, and tags"
    - "Clicking an issue row opens a push panel showing issue detail with state transition buttons"
    - "Event detail shows formatted stack trace frames with file, line, function highlighted"
    - "Event detail shows breadcrumbs as a timeline of user actions"
    - "Issue detail allows state transitions (resolve, archive, unresolve) and user assignment"
    - "Event detail has previous/next navigation within the issue"
  artifacts:
    - path: "frontend/src/components/detail/event-detail.tsx"
      provides: "Event detail panel with all event fields rendered"
    - path: "frontend/src/components/detail/issue-detail.tsx"
      provides: "Issue detail panel with state management actions"
    - path: "frontend/src/components/detail/stack-trace.tsx"
      provides: "Formatted stack trace renderer"
    - path: "frontend/src/components/detail/breadcrumbs.tsx"
      provides: "Breadcrumb timeline renderer"
    - path: "frontend/src/components/detail/tag-list.tsx"
      provides: "Tag key-value pair renderer"
  key_links:
    - from: "frontend/src/components/detail/event-detail.tsx"
      to: "frontend/src/lib/api.ts"
      via: "api.events.detail call"
      pattern: "api\\.events\\.detail"
    - from: "frontend/src/components/detail/issue-detail.tsx"
      to: "frontend/src/lib/api.ts"
      via: "api.issues.resolve/archive/assign calls"
      pattern: "api\\.issues\\.(resolve|archive|assign)"
    - from: "frontend/src/pages/issues.tsx"
      to: "frontend/src/components/detail/issue-detail.tsx"
      via: "PushPanelLayout panel prop"
      pattern: "IssueDetail"
---

<objective>
Build the event detail and issue detail push panels (UI-03, UI-04) that render inside the PushPanelLayout when a row is clicked. Event detail shows full payload: formatted stack trace, breadcrumbs timeline, tags, user context, SDK info, and previous/next event navigation. Issue detail shows issue summary with action buttons for state transitions (resolve, archive, unresolve, assign).

Purpose: These detail panels are the deep-dive views where users investigate individual events and manage issue lifecycle. The push panel pattern (content compresses, no overlay) keeps the list context visible.
Output: Complete detail panels for events and issues with all data fields and management actions.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/95-react-frontend/95-RESEARCH.md
@.planning/phases/95-react-frontend/95-01-SUMMARY.md
@.planning/phases/95-react-frontend/95-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create event detail sub-components (stack trace, breadcrumbs, tags)</name>
  <files>
    frontend/src/components/detail/stack-trace.tsx
    frontend/src/components/detail/breadcrumbs.tsx
    frontend/src/components/detail/tag-list.tsx
  </files>
  <action>
    **Stack Trace (`stack-trace.tsx`):**
    Renders a formatted stack trace from the event's `stacktrace` field (JSON object/array).
    - Props: `{ stacktrace: any }` (backend sends raw JSON)
    - Parse stacktrace as array of frames. Each frame has: `filename`, `lineno`, `colno`, `function`, `context_line`, `pre_context`, `post_context` (some may be null)
    - Render each frame as a collapsible row:
      - Header: `function` name in monospace bold, `filename:lineno` in muted monospace
      - Expanded (click to toggle): show context lines with line numbers, highlight the `context_line` with a subtle background
    - Most recent frame (index 0) expanded by default, others collapsed
    - Use `font-mono text-sm` for all code content (JetBrains Mono)
    - Subtle border between frames
    - Handle null/empty stacktrace: show "No stack trace available" message
    - Style: dark code background (using `bg-muted`), clean monospace rendering

    **Breadcrumbs (`breadcrumbs.tsx`):**
    Renders a timeline of breadcrumb entries from the event's `breadcrumbs` field.
    - Props: `{ breadcrumbs: any }` (array of breadcrumb objects)
    - Each breadcrumb has: `type`, `category`, `message`, `timestamp`, `data`, `level`
    - Render as a vertical timeline with small dots/circles on the left
    - Each entry: category in bold, message text, timestamp (relative), optional level badge
    - Data field (if present) rendered as collapsible JSON
    - Chronological order (oldest first, newest last)
    - Handle null/empty: show "No breadcrumbs recorded"
    - Compact, clean timeline styling with `border-l` connector line

    **Tag List (`tag-list.tsx`):**
    Renders key-value tag pairs from the event's `tags` field.
    - Props: `{ tags: Record<string, string> }`
    - Render as a grid of key-value pairs (2 columns on wider panels)
    - Key in `text-muted-foreground font-mono text-xs`, value in `font-mono text-sm`
    - Each pair has subtle background `bg-muted rounded px-2 py-1`
    - Handle null/empty: show "No tags"
    - Common tags: browser, os, url, runtime, device, etc.
  </action>
  <verify>
    Run `cd frontend && npx tsc --noEmit` to verify all sub-components compile.
  </verify>
  <done>
    Stack trace renders collapsible frames with highlighted context lines in monospace. Breadcrumbs render as a vertical timeline. Tags render as a grid of key-value pairs. All handle empty/null data gracefully.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build event detail and issue detail push panels, wire into pages</name>
  <files>
    frontend/src/components/detail/event-detail.tsx
    frontend/src/components/detail/issue-detail.tsx
    frontend/src/pages/issues.tsx
    frontend/src/pages/events.tsx
  </files>
  <action>
    **Event Detail (`event-detail.tsx`):**
    Full event detail panel rendered inside PushPanelLayout.
    - Props: `{ eventId: string, onClose: () => void }`
    - Fetches full event detail from `api.events.detail(eventId)` on mount
    - Loading state: skeleton placeholder matching panel layout
    - Panel header: close button (X icon), event level badge, event ID (mono, truncated)
    - Content sections (scrollable, separated by subtle borders):
      1. **Message**: event message text, prominent
      2. **Exception**: exception type and value if present
      3. **Stack Trace**: `<StackTrace stacktrace={event.stacktrace} />`
      4. **Breadcrumbs**: `<Breadcrumbs breadcrumbs={event.breadcrumbs} />`
      5. **Tags**: `<TagList tags={event.tags} />`
      6. **User Context**: if present, show user ID, email, username in a small card
      7. **SDK**: sdk_name and sdk_version in muted text at bottom
      8. **Metadata**: received_at timestamp, fingerprint (mono text)
    - Navigation: Previous/Next buttons at the top of the panel. Use `navigation.prev_id` and `navigation.next_id` from the API response. Clicking loads the adjacent event. Buttons disabled when null.
    - Entire panel wrapped in `<ScrollArea>` for long content

    **Issue Detail (`issue-detail.tsx`):**
    Issue management panel rendered inside PushPanelLayout.
    - Props: `{ issueId: string, onClose: () => void, onUpdate?: () => void }`
    - Fetches issue events from `api.issues.events(issueId, { limit: 5 })` to show recent events
    - Panel header: close button (X icon), issue title
    - Content sections:
      1. **Status & Level**: current status badge, level badge
      2. **Stats**: event count, first seen, last seen (formatted dates)
      3. **Actions**: state transition buttons:
         - If unresolved: "Resolve" button (calls `api.issues.resolve`), "Archive" button (calls `api.issues.archive`)
         - If resolved: "Unresolve" button (calls `api.issues.unresolve`), "Archive" button
         - If archived: "Unresolve" button
         - "Delete" button (destructive variant, with confirmation -- use shadcn Alert Dialog)
         - "Assign" button opening a small input for user_id (calls `api.issues.assign`)
      4. **Recent Events**: list of last 5 events for this issue (compact rows, clicking opens event detail)
    - After state transition: call `onUpdate` to refresh the parent list, update local state to reflect new status
    - Button loading states during API calls

    **Wire into pages:**
    Update `issues.tsx` and `events.tsx` to render the appropriate detail component in the PushPanelLayout's `panel` prop based on `uiStore.detailPanel`:
    - When `detailPanel?.type === 'issue'`: render `<IssueDetail issueId={detailPanel.id} onClose={uiStore.closeDetail} onUpdate={refetchIssues} />`
    - When `detailPanel?.type === 'event'`: render `<EventDetail eventId={detailPanel.id} onClose={uiStore.closeDetail} />`
    - Pass `null` when no detail panel is open
    - Ensure closing the panel restores full-width list view
  </action>
  <verify>
    Run `cd frontend && npx tsc --noEmit` to verify all components compile.
    Run `cd frontend && npm run build` to verify production build succeeds.
  </verify>
  <done>
    Event detail panel shows full event payload with formatted stack trace, breadcrumbs timeline, tags grid, user context, SDK info, and prev/next navigation. Issue detail panel shows status/stats and provides resolve/archive/unresolve/assign/delete action buttons. Both panels render inside PushPanelLayout on row click, compressing the list view. Close button dismisses the panel.
  </done>
</task>

</tasks>

<verification>
1. `cd frontend && npx tsc --noEmit` passes
2. `cd frontend && npm run build` succeeds
3. Clicking an issue row on /issues opens issue detail panel on the right
4. Issue detail shows status, stats, action buttons, and recent events
5. Clicking an event row on /events opens event detail panel on the right
6. Event detail shows message, stack trace, breadcrumbs, tags, and prev/next navigation
7. Close button dismisses the panel and restores full-width view
8. State transition buttons update issue status and refresh the list
</verification>

<success_criteria>
- Event detail panel with: message, exception, stack trace (collapsible frames), breadcrumbs (timeline), tags (grid), user context, SDK info, metadata, prev/next navigation
- Issue detail panel with: status/level badges, stats, action buttons (resolve/archive/unresolve/assign/delete), recent events list
- Stack trace renders with monospace code, highlighted context lines, collapsible frames
- Push panel pattern: main content compresses, detail panel on right with border-left
- Previous/next event navigation within an issue
- Delete confirmation via Alert Dialog
</success_criteria>

<output>
After completion, create `.planning/phases/95-react-frontend/95-04-SUMMARY.md`
</output>
