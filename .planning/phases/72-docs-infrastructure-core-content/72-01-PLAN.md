---
phase: 72-docs-infrastructure-core-content
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - website/docs/.vitepress/theme/components/ui/collapsible/
  - website/docs/.vitepress/theme/components/ui/scroll-area/
  - website/docs/.vitepress/theme/styles/main.css
  - website/docs/.vitepress/theme/styles/prose.css
  - website/docs/.vitepress/theme/composables/useSidebar.ts
  - website/docs/.vitepress/theme/composables/useOutline.ts
  - website/docs/.vitepress/theme/composables/usePrevNext.ts
  - website/docs/.vitepress/config.mts
autonomous: true

must_haves:
  truths:
    - "Sidebar config in themeConfig defines all 5 doc sections in 3 groups (Getting Started, Language Guide, Reference)"
    - "useSidebar composable resolves current sidebar from config, tracks open/close state, and auto-closes on route change"
    - "useOutline composable extracts headings from rendered DOM via onContentUpdated and builds a nested tree"
    - "usePrevNext composable computes previous/next links from flattened sidebar config"
    - "Typography prose classes render styled headings, lists, links, and code in both light and dark mode"
  artifacts:
    - path: "website/docs/.vitepress/theme/composables/useSidebar.ts"
      provides: "Sidebar resolution, active link detection, mobile open/close state"
      exports: ["useSidebar", "isActive"]
    - path: "website/docs/.vitepress/theme/composables/useOutline.ts"
      provides: "Heading extraction from DOM, nested outline tree building"
      exports: ["useOutline", "getHeaders", "OutlineItem"]
    - path: "website/docs/.vitepress/theme/composables/usePrevNext.ts"
      provides: "Previous/next page computation from sidebar config"
      exports: ["usePrevNext"]
    - path: "website/docs/.vitepress/config.mts"
      provides: "Sidebar navigation structure in themeConfig.sidebar"
      contains: "themeConfig"
    - path: "website/docs/.vitepress/theme/styles/prose.css"
      provides: "Typography variable overrides for monochrome palette"
      contains: "--tw-prose-body"
    - path: "website/docs/.vitepress/theme/styles/main.css"
      provides: "Typography plugin activation and prose.css import"
      contains: "@plugin"
  key_links:
    - from: "website/docs/.vitepress/theme/composables/useSidebar.ts"
      to: "website/docs/.vitepress/config.mts"
      via: "useData().theme.value.sidebar reads themeConfig.sidebar"
      pattern: "theme\\.value\\.sidebar"
    - from: "website/docs/.vitepress/theme/composables/usePrevNext.ts"
      to: "website/docs/.vitepress/theme/composables/useSidebar.ts"
      via: "imports isActive for current page detection"
      pattern: "import.*isActive.*from.*useSidebar"
    - from: "website/docs/.vitepress/theme/composables/useOutline.ts"
      to: "vitepress"
      via: "onContentUpdated hook for re-extraction on page change"
      pattern: "onContentUpdated"
---

<objective>
Scaffold UI primitives (Collapsible, ScrollArea), activate typography plugin, create prose overrides, build three docs composables (useSidebar, useOutline, usePrevNext), and define sidebar navigation config.

Purpose: Provides the foundational building blocks that the docs layout components (Plan 02) will consume. Without these composables and primitives, the sidebar, TOC, and prev/next cannot function.
Output: Three composables, two shadcn-vue component sets, typography activation, sidebar config in VitePress config.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/72-docs-infrastructure-core-content/72-RESEARCH.md

@website/docs/.vitepress/config.mts
@website/docs/.vitepress/theme/styles/main.css
@website/docs/.vitepress/theme/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold shadcn-vue primitives and activate typography</name>
  <files>
    website/docs/.vitepress/theme/components/ui/collapsible/
    website/docs/.vitepress/theme/components/ui/scroll-area/
    website/docs/.vitepress/theme/styles/main.css
    website/docs/.vitepress/theme/styles/prose.css
  </files>
  <action>
    1. Run `npx shadcn-vue@latest add collapsible scroll-area` from the website/ directory to scaffold both component sets.

    2. Add `@plugin "@tailwindcss/typography";` to main.css (after the existing imports, before `@custom-variant`). Also add `@import "./prose.css";` after the code.css import.

    3. Create prose.css with CSS variable overrides to map prose colors to the site's existing OKLCH palette variables:
       - --tw-prose-body: var(--foreground)
       - --tw-prose-headings: var(--foreground)
       - --tw-prose-links: var(--foreground)
       - --tw-prose-bold: var(--foreground)
       - --tw-prose-code: var(--foreground)
       - --tw-prose-pre-bg: var(--muted)
       - --tw-prose-hr: var(--border)
       - --tw-prose-th-borders: var(--border)
       - --tw-prose-td-borders: var(--border)
       - --tw-prose-counters: var(--muted-foreground)
       - --tw-prose-bullets: var(--muted-foreground)
       - --tw-prose-quotes: var(--muted-foreground)
       - --tw-prose-quote-borders: var(--border)
       - --tw-prose-captions: var(--muted-foreground)
       Also add a rule for `.prose :where(a)` with text-decoration: underline, text-underline-offset: 2px, font-weight: 500.
       Also add a rule for `.prose :where(pre):not(:where(.not-prose, .not-prose *))` with background-color: transparent, padding: 0, margin: 0, border-radius: 0 to prevent prose from double-styling code blocks that already have code.css styles.

    4. Verify `npm run build` passes from website/ directory.
  </action>
  <verify>
    - `ls website/docs/.vitepress/theme/components/ui/collapsible/` shows Collapsible component files
    - `ls website/docs/.vitepress/theme/components/ui/scroll-area/` shows ScrollArea component files
    - `grep "@plugin" website/docs/.vitepress/theme/styles/main.css` shows typography plugin
    - `cat website/docs/.vitepress/theme/styles/prose.css` shows prose variable overrides
    - `cd website && npm run build` succeeds without errors
  </verify>
  <done>
    Collapsible and ScrollArea shadcn-vue components are scaffolded and importable. Typography plugin is activated. Prose CSS overrides map to site's OKLCH palette. Build passes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create docs composables and sidebar config</name>
  <files>
    website/docs/.vitepress/theme/composables/useSidebar.ts
    website/docs/.vitepress/theme/composables/useOutline.ts
    website/docs/.vitepress/theme/composables/usePrevNext.ts
    website/docs/.vitepress/config.mts
  </files>
  <action>
    1. Create useSidebar.ts composable:
       - Import useData, useRoute from 'vitepress' and useMediaQuery from '@vueuse/core'
       - Define SidebarItem interface (text?, link?, items?, collapsed?, base?, docFooterText?)
       - Export useSidebar() function that:
         a) Gets theme, page, frontmatter from useData(), route from useRoute()
         b) Creates is960 = useMediaQuery('(min-width: 960px)') for responsive behavior
         c) Creates isOpen ref for mobile sidebar state
         d) Computes sidebar from theme.value.sidebar with multi-sidebar path resolution (find matching key by longest prefix)
         e) Computes hasSidebar = frontmatter.sidebar !== false AND sidebar.length > 0 AND frontmatter.layout !== 'home'
         f) Watches route.path to auto-close mobile sidebar (isOpen = false)
         g) Returns { sidebar, hasSidebar, isOpen, is960, open, close, toggle }
       - Export isActive(currentPath, matchPath) function that normalizes both paths (strip index.md, .md, .html extensions, trailing slashes) and checks if currentPath starts with matchPath
       - Include ensureStartingSlash helper

    2. Create useOutline.ts composable:
       - Import onContentUpdated, getScrollOffset from 'vitepress', useData from 'vitepress'
       - Export OutlineItem interface: { element: HTMLElement, title: string, link: string, level: number, children: OutlineItem[] }
       - Export useOutline() that:
         a) Gets theme, frontmatter from useData()
         b) Creates headers shallowRef<OutlineItem[]>([])
         c) Uses onContentUpdated(() => { headers.value = getHeaders(...) })
         d) Returns { headers }
       - Export getHeaders(range) that:
         a) Queries '.docs-content :where(h1,h2,h3,h4,h5,h6)' from document
         b) Filters to elements with id and child nodes
         c) Maps to OutlineItem objects using serializeHeader() to extract text (skip .header-anchor and .ignore-header elements)
         d) Parses range config (number, array [high,low], 'deep', or object {level})
         e) Calls buildTree to nest items by level
       - Implement serializeHeader(h: HTMLElement) that walks childNodes, skips header-anchor/ignore-header class elements, collects textContent
       - Implement buildTree(data, min, max) using stack-based nesting algorithm

    3. Create usePrevNext.ts composable:
       - Import computed from 'vue', useData from 'vitepress', isActive from './useSidebar'
       - Export usePrevNext() that returns a computed with { prev, next } objects:
         a) Gets page, theme, frontmatter from useData()
         b) Resolves current sidebar from theme.value.sidebar using resolveSidebar()
         c) Flattens all links using flattenSidebarLinks()
         d) Deduplicates with uniqBy on link path (strip query/hash)
         e) Finds current page index using isActive()
         f) Returns prev (index-1) and next (index+1), respecting frontmatter.prev/next === false overrides
         g) Uses docFooterText or text for display

    4. Update config.mts to add themeConfig with sidebar configuration:
       ```
       themeConfig: {
         sidebar: {
           '/docs/': [
             {
               text: 'Getting Started',
               items: [
                 { text: 'Introduction', link: '/docs/getting-started/' },
               ],
             },
             {
               text: 'Language Guide',
               collapsed: false,
               items: [
                 { text: 'Language Basics', link: '/docs/language-basics/' },
                 { text: 'Type System', link: '/docs/type-system/' },
                 { text: 'Concurrency', link: '/docs/concurrency/' },
               ],
             },
             {
               text: 'Reference',
               collapsed: false,
               items: [
                 { text: 'Syntax Cheatsheet', link: '/docs/cheatsheet/' },
               ],
             },
           ],
         },
         outline: { level: [2, 3], label: 'On this page' },
       }
       ```

    5. Verify `npm run build` passes from website/ directory.
  </action>
  <verify>
    - `cat website/docs/.vitepress/theme/composables/useSidebar.ts` exports useSidebar and isActive
    - `cat website/docs/.vitepress/theme/composables/useOutline.ts` exports useOutline and getHeaders
    - `cat website/docs/.vitepress/theme/composables/usePrevNext.ts` exports usePrevNext
    - `grep "themeConfig" website/docs/.vitepress/config.mts` shows sidebar config
    - `cd website && npm run build` succeeds without errors
  </verify>
  <done>
    Three composables (useSidebar, useOutline, usePrevNext) created with correct VitePress API usage. Sidebar config defines 3 groups with 5 documentation pages. usePrevNext imports isActive from useSidebar. Build passes.
  </done>
</task>

</tasks>

<verification>
- All shadcn-vue primitives (Collapsible, ScrollArea) installed and importable
- Typography plugin activated and prose.css overrides in place
- All three composables use VitePress public API (useData, useRoute, onContentUpdated) -- NOT vitepress/theme imports
- Sidebar config in themeConfig.sidebar defines /docs/ multi-sidebar with 3 groups
- usePrevNext correctly imports isActive from useSidebar (key cross-composable link)
- `cd website && npm run build` passes
</verification>

<success_criteria>
1. `npm run build` passes in website/ directory
2. Three composable files exist in composables/ with correct exports
3. Collapsible and ScrollArea directories exist in components/ui/
4. prose.css exists with OKLCH variable overrides
5. main.css has @plugin "@tailwindcss/typography" directive
6. config.mts has themeConfig.sidebar with /docs/ key and 3 sidebar groups
</success_criteria>

<output>
After completion, create `.planning/phases/72-docs-infrastructure-core-content/72-01-SUMMARY.md`
</output>
