---
phase: 73-extended-content-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - website/docs/docs/web/index.md
  - website/docs/docs/databases/index.md
autonomous: true

must_haves:
  truths:
    - "Web docs page covers HTTP server, routing, middleware, WebSocket, rooms/channels, and TLS with code examples"
    - "Database docs page covers SQLite, PostgreSQL, connection pooling, transactions, and struct mapping with code examples"
  artifacts:
    - path: "website/docs/docs/web/index.md"
      provides: "DOCS-05 web documentation"
      min_lines: 150
      contains: "HTTP.serve"
    - path: "website/docs/docs/databases/index.md"
      provides: "DOCS-06 database documentation"
      min_lines: 150
      contains: "Sqlite.open"
  key_links:
    - from: "website/docs/docs/web/index.md"
      to: "tests/e2e/stdlib_http_*.mpl"
      via: "code examples sourced from e2e tests"
      pattern: "HTTP\\."
    - from: "website/docs/docs/databases/index.md"
      to: "tests/e2e/stdlib_sqlite.mpl"
      via: "code examples sourced from e2e tests"
      pattern: "Sqlite\\."
---

<objective>
Write comprehensive Web and Database documentation pages for Mesh.

Purpose: Fulfills DOCS-05 (web features) and DOCS-06 (database features), covering the two largest remaining documentation areas with code examples sourced from e2e tests and runtime source.
Output: Two complete markdown doc pages ready for sidebar integration.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/73-extended-content-polish/73-RESEARCH.md

# Source files for code examples
@tests/e2e/stdlib_http_basic.mpl
@tests/e2e/stdlib_http_middleware.mpl
@tests/e2e/stdlib_http_path_params.mpl
@tests/e2e/stdlib_http_method_routing.mpl
@tests/e2e/stdlib_http_json.mpl
@tests/e2e/stdlib_sqlite.mpl
@tests/e2e/stdlib_pg.mpl
@tests/e2e/deriving_row_basic.mpl
@tests/e2e/deriving_row_types.mpl

# Codegen mapping for API surface verification
@crates/mesh-codegen/src/mir/lower.rs (lines 9445-9544 for HTTP/WS/DB/Dist function mapping)

# Runtime source for WebSocket rooms, pooling, TLS
@crates/mesh-rt/src/ws/rooms.rs
@crates/mesh-rt/src/ws/server.rs
@crates/mesh-rt/src/db/pool.rs

# Reference existing docs for style/structure consistency
@website/docs/docs/language-basics/index.md
@website/docs/docs/concurrency/index.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Write Web documentation (DOCS-05)</name>
  <files>website/docs/docs/web/index.md</files>
  <action>
Create the web documentation page at website/docs/docs/web/index.md covering:

1. **HTTP Server** - Creating a basic server with `HTTP.serve(router, port)`, returning responses with `HTTP.response(status, body)`
2. **Routing** - `HTTP.router()`, `HTTP.route(router, path, handler)`, method-specific routes (`HTTP.on_get`, `HTTP.on_post`, etc.), path parameters with `:param` syntax and `Request.param(request, "name")`
3. **Middleware** - `HTTP.use(router, middleware_fn)`, middleware function signature `fn(request :: Request, next) -> Response` with the `next(request)` continuation pattern
4. **JSON** - `HTTP.json_response(status, data)` and `Request.json(request)` for JSON request/response handling
5. **WebSocket** - `Ws.serve(on_connect, on_message, on_close, port)`, sending with `Ws.send(conn, msg)`, rooms with `Ws.join(conn, room)`, `Ws.broadcast(room, msg)`, `Ws.broadcast_except(room, msg, conn)`
6. **TLS** - `HTTP.serve_tls(router, port, cert, key)` and `Ws.serve_tls(on_connect, on_message, on_close, port, cert, key)`

Use the same markdown structure as existing docs: frontmatter with title, h2 for major sections, h3 for subsections, `mesh` code fences for all examples. Source ALL code examples from e2e test files (`tests/e2e/stdlib_http_*.mpl`) -- for WebSocket/TLS examples without e2e tests, derive from the codegen mapping in `mir/lower.rs` and runtime source, and mark with a comment like "# Derived from runtime API" where applicable.

Follow prior decisions: use `T!E` syntax for Result types, `?` operator for error propagation, document `from ... import` module syntax where relevant.

Add frontmatter: `title: "Web"` and `description: "HTTP servers, routing, middleware, WebSocket, and TLS in Mesh"`.
  </action>
  <verify>
The file exists at website/docs/docs/web/index.md, contains mesh code blocks, covers HTTP (serve, routing, middleware, JSON), WebSocket (serve, rooms, broadcast), and TLS sections. Verify no invented function names by cross-checking against the codegen mapping: HTTP functions start with `http_`, Ws functions start with `ws_`, Request functions start with `http_request_`.
  </verify>
  <done>Web docs page has 6+ sections covering HTTP server, routing, middleware, JSON, WebSocket, and TLS with syntactically accurate Mesh code examples</done>
</task>

<task type="auto">
  <name>Task 2: Write Database documentation (DOCS-06)</name>
  <files>website/docs/docs/databases/index.md</files>
  <action>
Create the database documentation page at website/docs/docs/databases/index.md covering:

1. **SQLite** - `Sqlite.open(path)`, `Sqlite.execute(db, sql, params)`, `Sqlite.query(db, sql, params)`, `Sqlite.close(db)`, in-memory databases with `":memory:"`
2. **PostgreSQL** - `Pg.connect(url)`, `Pg.execute(conn, sql, params)`, `Pg.query(conn, sql, params)`, `Pg.close(conn)`, connection string format
3. **Connection Pooling** - `Pool.open(url, min, max, timeout_ms)`, `Pool.query(pool, sql, params)`, `Pool.execute(pool, sql, params)`, `Pool.close(pool)`, explaining min/max connections and timeout
4. **Transactions** - `Sqlite.execute_batch(db, sql)` for multi-statement execution, `Pg.execute` for transaction BEGIN/COMMIT patterns
5. **Struct Mapping** - `deriving(Row)` for automatic database row mapping, `User.from_row(map)` pattern, supported field types (String, Int, Float, Bool)

Use the same markdown structure as existing docs. Source code examples from e2e tests (`stdlib_sqlite.mpl`, `stdlib_pg.mpl`, `deriving_row_basic.mpl`, `deriving_row_types.mpl`). For connection pooling examples (no e2e tests), derive from the codegen mapping and `crates/mesh-rt/src/db/pool.rs`.

Add frontmatter: `title: "Databases"` and `description: "SQLite, PostgreSQL, connection pooling, and struct mapping in Mesh"`.
  </action>
  <verify>
The file exists at website/docs/docs/databases/index.md, contains mesh code blocks, covers SQLite, PostgreSQL, pooling, transactions, and struct mapping. Verify function names match codegen mapping: Sqlite -> `sqlite_*`, Pg -> `pg_*`, Pool -> `pool_*`.
  </verify>
  <done>Database docs page has 5+ sections covering SQLite, PostgreSQL, connection pooling, transactions, and struct mapping with accurate code examples</done>
</task>

</tasks>

<verification>
1. Both markdown files exist and have 150+ lines each
2. All code examples use `mesh` code fences
3. Function names match the codegen mapping in `mir/lower.rs`
4. No invented syntax -- all examples sourced from e2e tests or runtime source
5. Consistent formatting with existing docs (language-basics, concurrency)
</verification>

<success_criteria>
- website/docs/docs/web/index.md exists with comprehensive HTTP, WebSocket, and TLS documentation
- website/docs/docs/databases/index.md exists with comprehensive SQLite, PostgreSQL, pooling, and struct mapping documentation
- All code examples are syntactically consistent with the Mesh language as defined in e2e tests
</success_criteria>

<output>
After completion, create `.planning/phases/73-extended-content-polish/73-01-SUMMARY.md`
</output>
