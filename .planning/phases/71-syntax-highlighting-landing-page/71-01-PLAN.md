---
phase: 71-syntax-highlighting-landing-page
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - website/docs/.vitepress/theme/shiki/mesh-light.json
  - website/docs/.vitepress/theme/shiki/mesh-dark.json
  - website/docs/.vitepress/theme/styles/code.css
  - website/docs/.vitepress/theme/styles/main.css
  - website/docs/.vitepress/config.mts
autonomous: true

must_haves:
  truths:
    - "Mesh code blocks in markdown render with syntax highlighting -- keywords, types, operators, strings, comments all visually distinct"
    - "Code blocks use monochrome theme matching the site's grayscale aesthetic"
    - "Code highlighting respects dark/light mode toggle without page reload"
  artifacts:
    - path: "website/docs/.vitepress/theme/shiki/mesh-light.json"
      provides: "Light monochrome Shiki theme with per-scope token colors"
      contains: "mesh-light"
    - path: "website/docs/.vitepress/theme/shiki/mesh-dark.json"
      provides: "Dark monochrome Shiki theme with per-scope token colors"
      contains: "mesh-dark"
    - path: "website/docs/.vitepress/theme/styles/code.css"
      provides: "Dual-theme CSS for .vp-code span elements"
      contains: "--shiki-dark"
    - path: "website/docs/.vitepress/config.mts"
      provides: "VitePress config with Mesh language and dual themes registered"
      contains: "markdown"
  key_links:
    - from: "website/docs/.vitepress/config.mts"
      to: "editors/vscode-mesh/syntaxes/mesh.tmLanguage.json"
      via: "JSON import for grammar registration"
      pattern: "meshGrammar"
    - from: "website/docs/.vitepress/config.mts"
      to: "website/docs/.vitepress/theme/shiki/mesh-light.json"
      via: "JSON import for light theme"
      pattern: "meshLight"
    - from: "website/docs/.vitepress/theme/styles/code.css"
      to: "Shiki-generated HTML"
      via: "CSS selectors targeting .vp-code span"
      pattern: "\\.vp-code span"
---

<objective>
Register the Mesh TextMate grammar and custom monochrome Shiki themes into VitePress so that ```mesh code fences render with syntax highlighting in both light and dark modes.

Purpose: This is the syntax highlighting infrastructure that all future code examples (landing page, docs) depend on. Without it, code blocks render as unstyled monochrome <pre> text.
Output: Two Shiki theme JSON files, code block CSS, updated VitePress config with grammar + themes registered.
</objective>

<execution_context>
@/Users/sn0w/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sn0w/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/71-syntax-highlighting-landing-page/71-RESEARCH.md
@website/docs/.vitepress/config.mts
@website/docs/.vitepress/theme/styles/main.css
@editors/vscode-mesh/syntaxes/mesh.tmLanguage.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create monochrome Shiki themes and code block CSS</name>
  <files>
    website/docs/.vitepress/theme/shiki/mesh-light.json
    website/docs/.vitepress/theme/shiki/mesh-dark.json
    website/docs/.vitepress/theme/styles/code.css
    website/docs/.vitepress/theme/styles/main.css
  </files>
  <action>
Create two TextMate JSON theme files for Shiki that use ONLY grayscale hex colors. Both themes MUST have a `"name"` field matching exactly `"mesh-light"` / `"mesh-dark"` and a `"type"` field of `"light"` / `"dark"`.

**Light theme (`mesh-light.json`)** -- background #ffffff, foreground #1a1a1a:
- Default settings: foreground #1a1a1a, background #f5f5f5
- Comments (`comment`, `comment.line`): #a0a0a0, italic
- Strings (`string`, `string.quoted`): #555555
- Keywords control (`keyword.control.mesh`): #000000, bold
- Keywords declaration (`keyword.declaration.mesh`): #000000, bold
- Keywords operator (`keyword.operator.mesh`): #333333, bold
- Types (`entity.name.type`, `support.type`): #333333, italic
- Functions (`entity.name.function`, `support.function`): #222222
- Constants/booleans (`constant`, `constant.language`, `constant.numeric`): #666666
- Variables (`variable`, `variable.other`): #2a2a2a
- Operators (`keyword.operator.pipe`, `keyword.operator.arrow`, `keyword.operator.annotation`, `keyword.operator.comparison`, `keyword.operator.arithmetic`, `keyword.operator.assignment`): #444444
- Punctuation (`punctuation`): #888888
- Escape characters (`constant.character.escape`): #666666
- Interpolation (`meta.interpolation`, `punctuation.section.interpolation`): #444444

**Dark theme (`mesh-dark.json`)** -- background #1a1a1a, foreground #e5e5e5:
Invert the lightness hierarchy. Keywords become brightest (#ffffff, bold), comments become dimmest (#666666, italic), types bright (#cccccc, italic), functions (#dddddd), strings (#999999), constants (#888888), variables (#d0d0d0), operators (#aaaaaa), punctuation (#777777). Background should be #1e1e1e (slightly lighter than pure black for readability).

Each theme must have a `tokenColors` array with the first entry being the default settings object (no `scope`, just `settings` with `foreground` and `background`).

**Code block CSS (`code.css`):**
Create `website/docs/.vitepress/theme/styles/code.css` with:
1. Dual-theme switching: `.dark .vp-code span` uses `color: var(--shiki-dark, inherit)`, `font-style: var(--shiki-dark-font-style, inherit)`, `font-weight: var(--shiki-dark-font-weight, inherit)`. Similarly `html:not(.dark) .vp-code span` uses the `--shiki-light` variants.
2. Code block container: `div[class*='language-']` with border-radius, overflow hidden
3. Pre element: background-color var(--muted) for light, .dark variant uses var(--secondary)
4. Code font: monospace stack (ui-monospace, SFMono-Regular, Menlo, Consolas, monospace), font-size 0.875rem, line-height 1.7
5. No language label (skip the ::before content, we don't need it yet)

**Update main.css:**
Add `@import "./code.css";` after the existing `@import "tw-animate-css";` line. Do NOT remove or change any existing content in main.css.
  </action>
  <verify>
All four files exist: `ls website/docs/.vitepress/theme/shiki/mesh-light.json website/docs/.vitepress/theme/shiki/mesh-dark.json website/docs/.vitepress/theme/styles/code.css`. Verify mesh-light.json contains `"name": "mesh-light"` and mesh-dark.json contains `"name": "mesh-dark"`. Verify code.css contains `--shiki-dark`. Verify main.css contains `@import "./code.css"`.
  </verify>
  <done>Two theme JSONs exist with correct name/type fields and tokenColors arrays. code.css handles dual-theme span coloring. main.css imports code.css.</done>
</task>

<task type="auto">
  <name>Task 2: Register Mesh grammar and themes in VitePress config</name>
  <files>
    website/docs/.vitepress/config.mts
  </files>
  <action>
Update `website/docs/.vitepress/config.mts` to:

1. Add imports at the top (after existing imports):
   - `import meshGrammar from '../../../editors/vscode-mesh/syntaxes/mesh.tmLanguage.json'` (3 levels up from `website/docs/.vitepress/` to repo root, then into `editors/`)
   - `import meshLight from './theme/shiki/mesh-light.json'`
   - `import meshDark from './theme/shiki/mesh-dark.json'`

2. Add `markdown` config to `defineConfig` (as a sibling to `appearance` and `vite`):
   ```
   markdown: {
     languages: [
       {
         ...(meshGrammar as any),
         name: 'mesh',
         aliases: ['mesh'],
       },
     ],
     theme: {
       light: meshLight as any,
       dark: meshDark as any,
     },
   },
   ```

3. Keep ALL existing config (appearance, vite plugins, alias) exactly as-is. Only ADD the imports and the markdown block.

Use `as any` casts per VitePress maintainer recommendation (TypeScript cannot infer deep TextMate JSON types).

After updating config, create a test markdown page at `website/docs/test-highlight.md` with frontmatter `title: Highlight Test` and several mesh code fences using the example code from the research (hero example, actor example, pattern matching). This page is for verification only.

Then run: `cd /Users/sn0w/Documents/dev/snow/website && npm run build` to verify the build succeeds with the new grammar and themes. If the build fails due to JSON import issues, try adding `assert { type: 'json' }` or using `createRequire` from `node:module` as fallback.

After successful build, delete the test page (`website/docs/test-highlight.md`) -- it was only for verification.
  </action>
  <verify>
Run `cd /Users/sn0w/Documents/dev/snow/website && npm run build` -- must succeed with no errors. The built HTML for the test page (before deletion) should contain `<span style="--shiki-light:` and `--shiki-dark:` attributes, confirming dual-theme highlighting works.
  </verify>
  <done>VitePress config registers Mesh grammar and dual monochrome themes. `npm run build` succeeds. Mesh code fences produce Shiki-highlighted HTML with dual-theme CSS variables.</done>
</task>

</tasks>

<verification>
1. `cd /Users/sn0w/Documents/dev/snow/website && npm run build` completes without errors
2. Generated HTML contains Shiki CSS variables (`--shiki-light`, `--shiki-dark`) on code span elements
3. Theme files are valid JSON with correct structure (name, type, colors, tokenColors)
4. code.css is imported via main.css and targets `.vp-code span` elements
</verification>

<success_criteria>
- Mesh code blocks in VitePress markdown render with syntax highlighting
- Keywords appear bold, types appear italic, comments appear faded (distinct visual treatments)
- Dark mode and light mode each use their respective monochrome theme
- Build succeeds with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/71-syntax-highlighting-landing-page/71-01-SUMMARY.md`
</output>
